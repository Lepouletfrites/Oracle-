<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- Ajout de viewport-fit=cover et fix hauteur mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Oracle JDR Solo - Fix Scroll</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #020617;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --accent: #d97706; 
            --border: #334155;
            --success: #22c55e;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* FIX CRITIQUE : Utilisation de dvh (Dynamic Viewport Height) pour mobile */
        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            height: 100dvh; /* Force la hauteur exacte de l'écran mobile */
            width: 100vw;
            overflow: hidden; /* Empêche le body de scroller */
            display: flex; 
            flex-direction: column; 
        }

        /* HEADER FIXE */
        header {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 0 15px;
            height: 50px;
            flex-shrink: 0; /* Ne rétrécit jamais */
            display: flex; justify-content: space-between; align-items: center;
            z-index: 20;
        }

        /* CONTENEUR PRINCIPAL */
        .app-container { 
            flex: 1; /* Prend tout l'espace restant */
            display: flex; 
            flex-direction: column; /* Mobile : Colonne */
            overflow: hidden; /* Empêche le débordement global */
            position: relative;
        }
        @media (min-width: 768px) { .app-container { flex-direction: row; } }

        /* ZONE DE CONTENU (Panneau du milieu) */
        main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; /* Important */
            position: relative; 
        }
        @media (min-width: 768px) { main { flex-direction: row; } }

        .content-panel {
            flex: 1;
            overflow-y: auto; /* SCROLL ICI UNIQUEMENT */
            overflow-x: hidden;
            padding: 15px;
            background: radial-gradient(circle at top right, #1e293b 0%, #0f172a 100%);
            /* Smooth scroll */
            -webkit-overflow-scrolling: touch;
        }

        /* HISTORIQUE (Panneau du bas/droite) */
        .history-panel {
            background-color: var(--bg-input);
            border-top: 1px solid var(--border);
            height: 35%; /* Fixe la hauteur à 35% de l'écran restant */
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            z-index: 15;
        }
        @media (min-width: 768px) {
            .history-panel { width: 300px; height: 100%; border-top: none; border-left: 1px solid var(--border); }
        }

        .history-header { 
            padding: 8px 15px; 
            border-bottom: 1px solid var(--border); 
            background: var(--bg-input);
            display: flex; justify-content: space-between; align-items: center; 
            font-size: 0.75rem; font-weight: bold; text-transform: uppercase; color: var(--text-muted);
            flex-shrink: 0;
        }

        .history-list { 
            flex: 1; 
            overflow-y: auto; /* SCROLL ICI UNIQUEMENT */
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            -webkit-overflow-scrolling: touch;
        }

        /* BARRE DE NAVIGATION (En bas) */
        nav {
            background-color: var(--bg-card);
            border-top: 1px solid var(--border);
            height: 60px;
            display: flex; justify-content: space-around; align-items: center;
            flex-shrink: 0; /* Ne rétrécit jamais */
            z-index: 20;
            padding-bottom: env(safe-area-inset-bottom); /* Pour iPhone X+ */
        }
        @media (min-width: 768px) {
            nav { width: 70px; height: 100%; flex-direction: column; justify-content: flex-start; padding-top: 20px; border-top: none; border-right: 1px solid var(--border); }
        }

        /* --- STYLES ÉLÉMENTS --- */
        .logo { display: flex; align-items: center; gap: 8px; color: var(--accent); font-weight: bold; font-size: 1rem; letter-spacing: 1px; }
        .btn-reset { background: none; border: 1px solid var(--border); color: var(--text-muted); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; display: flex; align-items: center; gap: 4px; }

        .nav-btn { background: none; border: none; color: var(--text-muted); display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 5px; width: 100%; position: relative; }
        .nav-btn svg { width: 22px; height: 22px; }
        .nav-btn span { font-size: 0.65rem; font-weight: 500; }
        .nav-btn.active { color: var(--accent); }

        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        h2 { font-size: 1.3rem; font-weight: 300; margin-bottom: 5px; text-align: center; color: #fff; }
        p.subtitle { color: var(--text-muted); text-align: center; font-size: 0.8rem; margin-bottom: 15px; }

        .btn-primary { background: var(--accent); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-size: 1rem; font-weight: bold; margin-bottom: 10px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-action { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main); padding: 12px; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.85rem; }
        
        .dice-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .btn-dice { background: var(--bg-card); border: 2px solid var(--border); color: var(--text-main); height: 60px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; }
        .btn-dice.highlight { border-color: var(--accent); background: rgba(217, 119, 6, 0.1); }

        .gen-item { background: var(--bg-card); border: 1px solid var(--border); padding: 10px; border-radius: 8px; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .gen-icon { background: var(--bg-input); padding: 6px; border-radius: 50%; display: flex; }
        .gen-content h4 { font-size: 0.85rem; color: #fff; }
        .gen-content p { font-size: 0.7rem; color: var(--text-muted); }

        textarea { width: 100%; height: 50vh; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 8px; padding: 10px; color: var(--text-main); font-size: 0.9rem; resize: none; outline: none; }

        .log-entry { background: rgba(30, 41, 59, 0.5); border-left: 3px solid var(--border); padding: 8px; border-radius: 4px; font-size: 0.85rem; animation: fadeIn 0.2s; }
        .log-meta { display: flex; justify-content: space-between; font-size: 0.65rem; opacity: 0.7; margin-bottom: 2px; text-transform: uppercase; font-weight: bold; }
        .log-details { font-size: 0.75rem; margin-top: 4px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.1); opacity: 0.8; white-space: pre-line; }

        .log-oracle.oui { border-color: var(--success); color: #86efac; background: rgba(34, 197, 94, 0.1); }
        .log-oracle.non { border-color: var(--danger); color: #fca5a5; background: rgba(239, 68, 68, 0.1); }
        
        .likelihood-row { display: flex; gap: 4px; margin-bottom: 15px; }
        .btn-like { flex: 1; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-muted); padding: 6px 0; border-radius: 4px; font-size: 0.65rem; font-weight: bold; text-transform: uppercase; }
        .btn-like.active { border-color: var(--accent); color: var(--accent); background: rgba(217, 119, 6, 0.1); }
        
        .input-group { display: flex; gap: 5px; margin-top: 10px; }
        .input-group input { flex: 1; background: var(--bg-input); border: 1px solid var(--border); color: white; padding: 8px; border-radius: 4px; font-size: 0.9rem; }
        .btn-add { background: var(--accent); color: white; border: none; width: 40px; border-radius: 4px; font-size: 1.2rem; }
        .interactive-list { max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 4px; padding: 5px; }
        .list-item { display: flex; justify-content: space-between; padding: 6px; background: var(--bg-card); border-radius: 4px; font-size: 0.85rem; margin-bottom: 4px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    </style>
</head>
<body>
    <!-- LE HEADER EST MAINTENANT FIXE EN HAUT DU BODY -->
    <header>
        <div class="logo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>
            JDR SOLO
        </div>
        <button class="btn-reset" onclick="if(confirm('Reset?')) localStorage.clear()||location.reload()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg> Reset
        </button>
    </header>

    <div id="root" class="app-container"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            Brain: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/></svg>,
            Dices: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/></svg>,
            List: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Book: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Trash: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Save: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            User: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Map: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>,
            Feather: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" x2="2" y1="8" y2="22"/></svg>,
            Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        };

        const DATA = {
            verbs: ["Attaquer", "Défendre", "Chercher", "Négocier", "Voler", "Surveiller", "Voyager", "Inspecter", "Trahir", "Sauver", "Détruire", "Créer", "Commander", "Fuir", "Cacher", "Révéler", "Capturer", "Libérer", "Changer", "Transporter", "Usurper", "Invoquer", "Bannir", "Séduire", "Intimider", "Soigner", "Empoisonner", "Piéger", "Guider", "Perdre", "Étudier", "Oublier", "Venger", "Pardonner", "Sacrifier", "Corrompre", "Purifier", "Échanger", "Voler", "Mentir"],
            nouns: ["Ennemi", "Ami", "Trésor", "Piège", "Secret", "Porte", "Monstre", "Magie", "Arme", "Information", "Danger", "Chemin", "Obstacle", "Récompense", "Nature", "Ville", "Ruine", "Dieu", "Roi", "Mort", "Ombre", "Lumière", "Temps", "Rêve", "Cauchemar", "Sang", "Or", "Savoir", "Folie", "Honneur", "Dette", "Promesse", "Fantôme", "Rituel", "Carte", "Clé", "Miroir", "Poison", "Remède", "Tempête"],
            npc: {
                races: ["Humain", "Elfe", "Nain", "Halfelin", "Orc", "Tieffelin", "Drakéide", "Gnome", "Aasimar", "Gobelin", "Tabaxi", "Changeforme"],
                classes: ["Guerrier", "Mage", "Voleur", "Clerc", "Barde", "Druide", "Paladin", "Rôdeur", "Sorcier", "Moine", "Barbare", "Artificier", "Nécromancien", "Marchand"],
                traits: ["Arrogant", "Timide", "Courageux", "Cupide", "Mystérieux", "Bavard", "Loyal", "Traître", "Blessé", "Riche", "Fanatique", "Mélancolique", "Naïf", "Cruel", "Séducteur", "Paranoïaque"],
                motivations: ["Cherche à retrouver un proche disparu", "Veut se venger d'un ancien affront", "Doit payer une dette colossale", "Fuit un passé criminel", "Recherche un artefact de pouvoir", "Veut prouver sa valeur à sa famille", "Est maudit et cherche un remède", "Sert une divinité obscure", "Veut juste s'enrichir", "Protège un secret d'état", "Recherche l'amour perdu", "Veut tuer un rival"],
                names_prefix: ["Ar", "Bor", "Cal", "Dor", "El", "Fal", "Gor", "Hal", "Ian", "Jar", "Kel", "Lor", "Mor", "Nal", "Or", "Pan", "Qu", "Ras", "Sil", "Tar", "Xan", "Zel"],
                names_suffix: ["an", "bos", "cor", "dil", "en", "fin", "gorn", "hion", "il", "jun", "kan", "los", "mir", "nor", "or", "phis", "quor", "ros", "sin", "tor", "thas", "vyr"]
            },
            dungeon: {
                type: ["Caverne naturelle", "Ruines antiques", "Crypte oubliée", "Temple profané", "Égouts labyrinthiques", "Forteresse naine", "Laboratoire arcanique", "Prison abandonnée"],
                feature: ["Un autel sanglant", "Une statue qui pleure", "Un gouffre sans fond", "Des champignons luminescents", "Un trône brisé", "Une fresque prophétique", "Une fontaine magique", "Des chaînes aux murs"],
                danger: ["Piège à fléchettes", "Sol instable", "Gaz toxique", "Embuscade de monstres", "Silence surnaturel", "Zone de magie morte", "Inondation soudaine", "Eboulis"]
            },
            quests: {
                clients: ["Un noble déchu", "Une guilde de voleurs", "Un esprit tourmenté", "Un marchand désespéré", "Un ordre religieux", "Un villageois terrifié", "Un dragon polymorphe", "Une voix dans votre tête"],
                targets: ["Retrouver", "Détruire", "Escorter", "Enquêter sur", "Voler", "Protéger", "Capturer", "Négocier avec"],
                objects: ["une relique maudite", "un héritier caché", "un monstre légendaire", "un document compromettant", "un lieu sacré", "une caravane de vivres", "une formule alchimique", "une âme emprisonnée"],
                twists: ["mais c'est un piège", "mais le temps est compté", "mais une faction rivale est déjà là", "mais l'objet est vivant", "mais cela réveillera un mal ancien", "mais le client a menti", "mais la cible est un allié", "mais il faut se sacrifier"]
            }
        };

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const generateName = () => getRandom(DATA.npc.names_prefix) + getRandom(DATA.npc.names_suffix);

        function SoloRPGApp() {
            const [activeTab, setActiveTab] = useState('oracle');
            const load = (k, d) => { try { return JSON.parse(localStorage.getItem(k)) || d } catch { return d } };
            const [logs, setLogs] = useState(() => load('rpg_logs_v6', []));
            const [journal, setJournal] = useState(() => localStorage.getItem('rpg_journal_v6') || "");
            const [lists, setLists] = useState(() => load('rpg_lists_v6', { npcs: [], threads: [] }));
            const [likelihood, setLikelihood] = useState(0);
            const logsEndRef = useRef(null);

            useEffect(() => localStorage.setItem('rpg_logs_v6', JSON.stringify(logs)), [logs]);
            useEffect(() => localStorage.setItem('rpg_journal_v6', journal), [journal]);
            useEffect(() => localStorage.setItem('rpg_lists_v6', JSON.stringify(lists)), [lists]);
            
            useEffect(() => logsEndRef.current?.scrollIntoView({ behavior: "smooth" }), [logs]);

            const addLog = (type, title, content, details = null) => {
                setLogs(prev => [...prev, { id: Date.now(), time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), type, title, content, details }]);
            };

            const rollDice = (sides) => {
                const res = Math.floor(Math.random() * sides) + 1;
                let crit = "";
                if(sides===20 && res===20) crit = " (CRITIQUE)";
                if(sides===20 && res===1) crit = " (ÉCHEC)";
                addLog('dice', `d${sides}`, `${res}${crit}`, null);
            };

            const oracle = () => {
                const r = Math.floor(Math.random() * 20) + 1;
                let thresh = 10;
                if (likelihood === -2) thresh = 18;
                if (likelihood === -1) thresh = 15;
                if (likelihood === 1) thresh = 5;
                if (likelihood === 2) thresh = 2;
                let ans = r > thresh ? "OUI" : "NON";
                if (r > thresh && r >= 19) ans = "OUI, ET...";
                else if (r > thresh && r % 2 !== 0) ans = "OUI, MAIS...";
                else if (r <= thresh && r <= 2) ans = "NON, ET...";
                else if (r <= thresh && r % 2 === 0) ans = "NON, MAIS...";
                addLog('oracle', 'Oracle', ans);
            };

            const gens = {
                muse: () => addLog('muse', 'Inspiration', `${getRandom(DATA.verbs)} / ${getRandom(DATA.nouns)}`),
                npc: () => addLog('npc', 'PNJ', generateName(), `${getRandom(DATA.npc.races)} ${getRandom(DATA.npc.classes)}\n${getRandom(DATA.npc.traits)}`),
                loc: () => addLog('loc', 'Lieu', getRandom(DATA.dungeon.type), `${getRandom(DATA.dungeon.feature)}\nDanger: ${getRandom(DATA.dungeon.danger)}`),
                quest: () => addLog('quest', 'Quête', 'Mission', `${getRandom(DATA.quests.clients)} veut ${getRandom(DATA.quests.targets)} ${getRandom(DATA.quests.objects)}.`)
            };

            const listActions = {
                add: (k, val) => { if(val) setLists(p => ({...p, [k]: [...p[k], val]})) },
                del: (k, idx) => setLists(p => ({...p, [k]: p[k].filter((_, i) => i !== idx)}))
            };

            const exportTxt = () => {
                const txt = `JOURNAL:\n${journal}\n\nHISTORIQUE:\n${logs.map(l => `[${l.time}] ${l.title}: ${l.content}`).join('\n')}`;
                const blob = new Blob([txt], {type:'text/plain'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob); a.download = 'jdr_solo.txt'; a.click();
            };

            return (
                <React.Fragment>
                    <main>
                        <div className="content-panel">
                            {activeTab === 'oracle' && (
                                <div className="card">
                                    <h2>L'Oracle</h2>
                                    <p className="subtitle">Posez une question binaire</p>
                                    <div className="likelihood-row">
                                        <button className={`btn-like ${likelihood===-2?'active':''}`} onClick={()=>setLikelihood(-2)}>Impos.</button>
                                        <button className={`btn-like ${likelihood===-1?'active':''}`} onClick={()=>setLikelihood(-1)}>Faible</button>
                                        <button className={`btn-like ${likelihood===0?'active':''}`} onClick={()=>setLikelihood(0)}>50/50</button>
                                        <button className={`btn-like ${likelihood===1?'active':''}`} onClick={()=>setLikelihood(1)}>Forte</button>
                                        <button className={`btn-like ${likelihood===2?'active':''}`} onClick={()=>setLikelihood(2)}>Certain</button>
                                    </div>
                                    <button className="btn-primary" onClick={oracle}>RÉVÉLER</button>
                                    <div className="btn-grid" style={{marginTop:10}}>
                                        <button className="btn-action" onClick={gens.muse}><Icons.Feather/> Inspiration</button>
                                        <button className="btn-action" onClick={()=>addLog('twist', 'Twist', getRandom(DATA.quests.twists))} style={{borderColor:'var(--danger)', color:'#fca5a5'}}><Icons.Zap/> Twist</button>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'dice' && (
                                <div className="card">
                                    <h2>Lancer de Dés</h2>
                                    <div className="dice-grid" style={{marginTop:20}}>
                                        {[4,6,8,10,12,20,100].map(d => (
                                            <button key={d} className={`btn-dice ${d===20?'highlight':''}`} onClick={()=>rollDice(d)}>d{d}</button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'tools' && (
                                <div style={{display:'flex', flexDirection:'column', gap:15}}>
                                    <div className="card">
                                        <h2>Générateurs</h2>
                                        <div style={{display:'grid', gap:8}}>
                                            <div className="gen-item" onClick={gens.npc}>
                                                <div className="gen-icon"><Icons.User/></div>
                                                <div className="gen-content"><h4>PNJ</h4><p>Identité, Race, Classe</p></div>
                                            </div>
                                            <div className="gen-item" onClick={gens.loc}>
                                                <div className="gen-icon"><Icons.Map/></div>
                                                <div className="gen-content"><h4>Lieu</h4><p>Donjon, Danger</p></div>
                                            </div>
                                            <div className="gen-item" onClick={gens.quest}>
                                                <div className="gen-icon"><Icons.List/></div>
                                                <div className="gen-content"><h4>Quête</h4><p>Client, Cible, Objectif</p></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="card">
                                        <h2>Listes</h2>
                                        <p style={{fontSize:'0.75rem', marginBottom:5, color:'var(--accent)'}}>FILS NARRATIFS</p>
                                        <InteractiveList items={lists.threads} add={(v)=>listActions.add('threads',v)} del={(i)=>listActions.del('threads',i)} />
                                        <p style={{fontSize:'0.75rem', marginBottom:5, color:'var(--accent)', marginTop:15}}>PNJ IMPORTANTS</p>
                                        <InteractiveList items={lists.npcs} add={(v)=>listActions.add('npcs',v)} del={(i)=>listActions.del('npcs',i)} />
                                    </div>
                                </div>
                            )}

                            {activeTab === 'journal' && (
                                <div className="card" style={{height:'100%', display:'flex', flexDirection:'column'}}>
                                    <div style={{display:'flex', justifyContent:'space-between', marginBottom:10}}>
                                        <h2>Journal</h2>
                                        <div style={{display:'flex', gap:10}}>
                                            <button onClick={()=>setJournal('')} style={{background:'none', border:'none', color:'var(--text-muted)'}}><Icons.Trash/></button>
                                            <button onClick={exportTxt} style={{background:'none', border:'none', color:'var(--accent)'}}><Icons.Save/></button>
                                        </div>
                                    </div>
                                    <textarea value={journal} onChange={(e)=>setJournal(e.target.value)} placeholder="Récit..."></textarea>
                                </div>
                            )}
                        </div>

                        <div className="history-panel">
                            <div className="history-header">
                                <span>Historique</span>
                                <button onClick={()=>setLogs([])} style={{background:'none', border:'none', color:'inherit'}}><Icons.Trash/></button>
                            </div>
                            <div className="history-list">
                                {logs.length === 0 && <div style={{textAlign:'center', color:'#64748b', fontSize:'0.8rem', marginTop:20}}>Vide</div>}
                                {logs.map((l) => (
                                    <div key={l.id} className={`log-entry log-${l.type} ${l.content.includes('OUI')?'oui':l.content.includes('NON')?'non':''}`}>
                                        <div className="log-meta"><span>{l.title}</span><span>{l.time}</span></div>
                                        <div className="log-content">{l.content}</div>
                                        {l.details && <div className="log-details">{l.details}</div>}
                                    </div>
                                ))}
                                <div ref={logsEndRef} />
                            </div>
                        </div>
                    </main>

                    <nav>
                        <button className={`nav-btn ${activeTab==='oracle'?'active':''}`} onClick={()=>setActiveTab('oracle')}><Icons.Brain/><span>Oracle</span></button>
                        <button className={`nav-btn ${activeTab==='dice'?'active':''}`} onClick={()=>setActiveTab('dice')}><Icons.Dices/><span>Dés</span></button>
                        <button className={`nav-btn ${activeTab==='tools'?'active':''}`} onClick={()=>setActiveTab('tools')}><Icons.List/><span>Outils</span></button>
                        <button className={`nav-btn ${activeTab==='journal'?'active':''}`} onClick={()=>setActiveTab('journal')}><Icons.Book/><span>Journal</span></button>
                    </nav>
                </React.Fragment>
            );
        }

        function InteractiveList({ items, add, del }) {
            const [val, setVal] = useState("");
            return (
                <div>
                    <div className="interactive-list">
                        {items.map((it, i) => (
                            <div key={i} className="list-item"><span>{it}</span><button style={{background:'none',border:'none',color:'var(--text-muted)'}} onClick={()=>del(i)}>x</button></div>
                        ))}
                    </div>
                    <div className="input-group">
                        <input value={val} onChange={e=>setVal(e.target.value)} onKeyDown={e=>e.key==='Enter' && (add(val), setVal(''))} placeholder="..." />
                        <button className="btn-add" onClick={()=>(add(val), setVal(''))}>+</button>
                    </div>
                </div>
            )
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SoloRPGApp />);
    </script>
</body>
</html>


