<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle JDR Solo</title>
    
    <!-- 1. Chargement de Tailwind CSS (Design) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Chargement de React et ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Chargement de Babel (Pour traduire le code React en direct) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Style personnalisé pour la scrollbar -->
    <style>
        body { background-color: #020617; color: #e2e8f0; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .animate-bounce-short { animation: bounce 0.3s ease-in-out 1; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <!-- 5. TON APPLICATION REACT -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICÔNES SVG (Pour éviter les imports Lucide qui font planter GitHub Pages) ---
        const Icons = {
            Skull: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
            Brain: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.97-1.375"/><path d="M17.97 16.625A4 4 0 0 1 16 18"/></svg>,
            Dices: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></svg>,
            Sparkles: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M19 15v4"/><path d="M23 17h-4"/></svg>,
            List: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            History: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Feather: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" x2="2" y1="8" y2="22"/><line x1="17.5" x2="9" y1="15" y2="15"/></svg>,
            RefreshCw: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Map: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>,
            Coins: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>,
            Swords: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="14.5 17.5 3 6 6 3 17.5 14.5"/><line x1="13" x2="19" y1="19" y2="13"/><line x1="16" x2="20" y1="16" y2="20"/><line x1="19" x2="21" y1="21" y2="19"/></svg>
        };

        const DATA = {
            verbs: [
                "Attaquer", "Défendre", "Chercher", "Négocier", "Voler", "Surveiller", "Voyager", "Inspecter", 
                "Trahir", "Sauver", "Détruire", "Créer", "Commander", "Fuir", "Cacher", "Révéler", 
                "Capturer", "Libérer", "Changer", "Transporter", "Usurper", "Invoquer", "Bannir", "Séduire",
                "Intimider", "Soigner", "Empoisonner", "Piéger", "Guider", "Perdre", "Étudier", "Oublier",
                "Venger", "Pardonner", "Sacrifier", "Corrompre", "Purifier", "Échanger", "Voler", "Mentir"
            ],
            nouns: [
                "Ennemi", "Ami", "Trésor", "Piège", "Secret", "Porte", "Monstre", "Magie", 
                "Arme", "Information", "Danger", "Chemin", "Obstacle", "Récompense", "Nature", "Ville",
                "Ruine", "Dieu", "Roi", "Mort", "Ombre", "Lumière", "Temps", "Rêve", "Cauchemar",
                "Sang", "Or", "Savoir", "Folie", "Honneur", "Dette", "Promesse", "Fantôme", "Rituel",
                "Carte", "Clé", "Miroir", "Poison", "Remède", "Tempête"
            ],
            npc: {
                races: ["Humain", "Elfe", "Nain", "Halfelin", "Orc", "Tieffelin", "Drakéide", "Gnome", "Aasimar", "Gobelin", "Tabaxi", "Changeforme"],
                classes: ["Guerrier", "Mage", "Voleur", "Clerc", "Barde", "Druide", "Paladin", "Rôdeur", "Sorcier", "Moine", "Barbare", "Artificier", "Nécromancien", "Marchand"],
                traits: ["Arrogant", "Timide", "Courageux", "Cupide", "Mystérieux", "Bavard", "Loyal", "Traître", "Blessé", "Riche", "Fanatique", "Mélancolique", "Naïf", "Cruel", "Séducteur", "Paranoïaque"],
                motivations: [
                "Cherche à retrouver un proche disparu", "Veut se venger d'un ancien affront", "Doit payer une dette colossale",
                "Fuit un passé criminel", "Recherche un artefact de pouvoir", "Veut prouver sa valeur à sa famille",
                "Est maudit et cherche un remède", "Sert une divinité obscure", "Veut juste s'enrichir", "Protège un secret d'état",
                "Recherche l'amour perdu", "Veut tuer un rival"
                ],
                names_prefix: ["Ar", "Bor", "Cal", "Dor", "El", "Fal", "Gor", "Hal", "Ian", "Jar", "Kel", "Lor", "Mor", "Nal", "Or", "Pan", "Qu", "Ras", "Sil", "Tar", "Xan", "Zel"],
                names_suffix: ["an", "bos", "cor", "dil", "en", "fin", "gorn", "hion", "il", "jun", "kan", "los", "mir", "nor", "or", "phis", "quor", "ros", "sin", "tor", "thas", "vyr"]
            },
            dungeon: {
                type: ["Caverne naturelle", "Ruines antiques", "Crypte oubliée", "Temple profané", "Égouts labyrinthiques", "Forteresse naine", "Laboratoire arcanique", "Prison abandonnée"],
                feature: ["Un autel sanglant", "Une statue qui pleure", "Un gouffre sans fond", "Des champignons luminescents", "Un trône brisé", "Une fresque prophétique", "Une fontaine magique", "Des chaînes aux murs"],
                danger: ["Piège à fléchettes", "Sol instable", "Gaz toxique", "Embuscade de monstres", "Silence surnaturel", "Zone de magie morte", "Inondation soudaine", "Eboulis"]
            },
            loot: {
                type: ["Pièces d'or", "Gemme précieuse", "Parchemin de sort", "Potion inconnue", "Arme ancienne", "Bijou maudit", "Carte au trésor", "Ingrédient rare"],
                quality: ["Terne et usé", "Éclatant de magie", "Couvert de sang", "D'une facture alien", "Vibrant d'énergie", "Froid au toucher", "Gravé de runes", "Incroyablement léger"]
            },
            quests: {
                clients: ["Un noble déchu", "Une guilde de voleurs", "Un esprit tourmenté", "Un marchand désespéré", "Un ordre religieux", "Un villageois terrifié", "Un dragon polymorphe", "Une voix dans votre tête"],
                targets: ["Retrouver", "Détruire", "Escorter", "Enquêter sur", "Voler", "Protéger", "Capturer", "Négocier avec"],
                objects: ["une relique maudite", "un héritier caché", "un monstre légendaire", "un document compromettant", "un lieu sacré", "une caravane de vivres", "une formule alchimique", "une âme emprisonnée"],
                twists: ["mais c'est un piège", "mais le temps est compté", "mais une faction rivale est déjà là", "mais l'objet est vivant", "mais cela réveillera un mal ancien", "mais le client a menti", "mais la cible est un allié", "mais il faut se sacrifier"]
            }
        };

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const generateName = () => getRandom(DATA.npc.names_prefix) + getRandom(DATA.npc.names_suffix);

        const safeLoad = (key, fallback) => {
            try {
                const saved = localStorage.getItem(key);
                return saved ? JSON.parse(saved) : fallback;
            } catch (e) {
                console.error("Erreur chargement", e);
                return fallback;
            }
        };

        // --- COMPOSANT PRINCIPAL ---
        function SoloRPGApp() {
            const [activeTab, setActiveTab] = useState('oracle');
            const [logs, setLogs] = useState(() => safeLoad('rpg_logs_v4', []));
            const [journal, setJournal] = useState(() => localStorage.getItem('rpg_journal_v4') || "");
            const [lists, setLists] = useState(() => safeLoad('rpg_lists_v4', { npcs: [], threads: [] }));
            const [likelihood, setLikelihood] = useState(0);
            const [animatingDice, setAnimatingDice] = useState(null);
            const logsEndRef = useRef(null);

            useEffect(() => localStorage.setItem('rpg_logs_v4', JSON.stringify(logs)), [logs]);
            useEffect(() => localStorage.setItem('rpg_journal_v4', journal), [journal]);
            useEffect(() => localStorage.setItem('rpg_lists_v4', JSON.stringify(lists)), [lists]);

            useEffect(() => {
                logsEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [logs]);

            const addLog = (type, title, content, details = null) => {
                const newLog = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    type,
                    title,
                    content,
                    details
                };
                setLogs(prev => [...prev, newLog]);
            };

            const hardReset = () => {
                if(window.confirm("Tout effacer et recommencer à zéro ?")) {
                    localStorage.clear();
                    window.location.reload();
                }
            };

            const clearLogs = () => {
                if(window.confirm("Effacer l'historique ?")) setLogs([]);
            };

            const exportJournal = () => {
                const element = document.createElement("a");
                const fileContent = `--- JOURNAL ---\n${journal}\n\n--- HISTORIQUE ---\n${logs.map(l => `[${l.timestamp}] ${l.title}: ${l.content}`).join('\n')}`;
                const file = new Blob([fileContent], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = "mon_jdr_solo.txt";
                document.body.appendChild(element);
                element.click();
            };

            const rollDice = (sides) => {
                setAnimatingDice(sides);
                setTimeout(() => setAnimatingDice(null), 300);

                const result = Math.floor(Math.random() * sides) + 1;
                let critical = "";
                let color = "text-slate-200";
                
                if (sides === 20) {
                    if (result === 20) { critical = " (CRITIQUE)"; color = "text-amber-400 font-bold"; }
                    if (result === 1) { critical = " (ÉCHEC)"; color = "text-red-400 font-bold"; }
                }
                
                addLog('dice', `d${sides}`, `${result}${critical}`, { rawValue: result, color });
            };

            const consultOracle = () => {
                let roll = Math.floor(Math.random() * 20) + 1;
                let answer = "";
                
                let threshold = 10; 
                if (likelihood === -2) threshold = 18;
                if (likelihood === -1) threshold = 15;
                if (likelihood === 0) threshold = 10;
                if (likelihood === 1) threshold = 5;
                if (likelihood === 2) threshold = 2;

                if (roll > threshold) {
                    if (roll >= 19) answer = "OUI, ET...";
                    else if (roll % 2 === 0) answer = "OUI";
                    else answer = "OUI, MAIS...";
                } else {
                    if (roll <= 2) answer = "NON, ET...";
                    else if (roll % 2 !== 0) answer = "NON";
                    else answer = "NON, MAIS...";
                }
                addLog('oracle', 'Oracle', answer);
            };

            const generators = {
                muse: () => addLog('muse', 'Inspiration', `${getRandom(DATA.verbs)} / ${getRandom(DATA.nouns)}`),
                npc: () => {
                    const name = generateName();
                    const race = getRandom(DATA.npc.races);
                    const classe = getRandom(DATA.npc.classes);
                    addLog('npc', 'Nouveau PNJ', name, {
                        subtitle: `${race} ${classe}`,
                        body: `Caractère: ${getRandom(DATA.npc.traits)}\nMotivation: ${getRandom(DATA.npc.motivations)}`
                    });
                },
                dungeon: () => {
                    addLog('loc', 'Lieu', getRandom(DATA.dungeon.type), {
                        body: `Détail: ${getRandom(DATA.dungeon.feature)}\nDanger: ${getRandom(DATA.dungeon.danger)}`
                    });
                },
                loot: () => {
                    addLog('loot', 'Butin', getRandom(DATA.loot.type), {
                        body: `Aspect: ${getRandom(DATA.loot.quality)}`
                    });
                },
                quest: () => {
                    addLog('quest', 'Quête', "Nouvelle Mission", { 
                        body: `${getRandom(DATA.quests.clients)} veut ${getRandom(DATA.quests.targets)} ${getRandom(DATA.quests.objects)}, ${getRandom(DATA.quests.twists)}.` 
                    });
                }
            };

            const addListItem = (listKey, item) => {
                if (!item || !item.trim()) return;
                setLists(prev => {
                    const currentList = prev[listKey] || []; 
                    return { ...prev, [listKey]: [...currentList, item] };
                });
            };

            const removeListItem = (listKey, index) => {
                setLists(prev => ({ ...prev, [listKey]: prev[listKey].filter((_, i) => i !== index) }));
            };

            return (
                <div className="flex flex-col h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden selection:bg-amber-900">
                    
                    {/* HEADER */}
         
